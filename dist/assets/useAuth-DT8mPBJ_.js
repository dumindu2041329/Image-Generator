import{r as w}from"./vendor-router-B0usbLSA.js";import{u as N,b as S}from"./vendor-clerk-6NQOkdVy.js";import{c as m}from"./vendor-supabase-l0Uqy5La.js";import{g as E,i as U}from"./index-CWCspKH8.js";const l="https://dxljyzvwolnbdreewbvs.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4bGp5enZ3b2xuYmRyZWV3YnZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyNTY0OTksImV4cCI6MjA3MjgzMjQ5OX0.hzNFBkxNMS6BwToieigRze1GEq_OSpzrXJpH92o0ouU",h=()=>!l.includes("YOUR_SUPABASE_URL")&&!u.includes("YOUR_SUPABASE_ANON_KEY")&&!l.includes("API_KEY_ADDED"),C=()=>h()?m(l,u,{global:{fetch:async(e,r={})=>{const d=await E();r.headers={apikey:u,...r.headers};const i=e.toString();if(i.includes("/rest/v1/"))(r.headers||{})["Content-Type"]||(r.headers={...r.headers,"Content-Type":"application/json"});else if(i.includes("/storage/v1/object/")){const c=r.headers||{};r.body&&!c["Content-Type"]&&(r.headers={...r.headers,"Content-Type":"application/json"})}if(d?(r.headers={...r.headers,Authorization:`Bearer ${d}`},console.log("Supabase request with token:",d.substring(0,50)+"...")):console.warn("No Clerk token available for Supabase request"),i.includes("/storage/v1/object/")&&console.log("Storage API request:",{url:i,method:r.method,headers:r.headers,body:r.body}),i.includes("/storage/v1/object/")&&r.body)try{if(typeof r.body=="string"){const c=JSON.parse(r.body);r.body=JSON.stringify(c)}}catch(c){console.warn("Failed to parse storage request body:",c)}return fetch(e,r)}}}):null,Z=C(),k=()=>h()?m(l,u):null,y=k(),q=async()=>{if(!y)return null;const e=await E();return console.log("Getting authenticated storage client, token available:",!!e),e?m(l,u,{global:{headers:{Authorization:`Bearer ${e}`}}}):y},x=e=>e?.id||null,L=e=>e?.emailAddresses?.[0]?.emailAddress||void 0,M=e=>e?.fullName||void 0,X=e=>e?.imageUrl||void 0,D=()=>{const{user:e,isLoaded:r,isSignedIn:d}=N(),i=S(),[c,A]=w.useState(!0),[n,I]=w.useState(!1),f=e?{id:e.id,emailAddresses:e.emailAddresses.map(t=>({emailAddress:t.emailAddress})),firstName:e.firstName,lastName:e.lastName,imageUrl:e.imageUrl,fullName:e.fullName}:null;return w.useEffect(()=>{const t=U()&&h();I(t),r&&A(!1)},[r]),{user:f,loading:c||!r,isConfigured:n,isSignedIn:!!d,signIn:async(t,a)=>{if(!n)throw new Error("Authentication not configured");try{const s=await i.client.signIn.create({identifier:t,password:a});if(s.status==="complete")return await i.setActive({session:s.createdSessionId}),{user:s};throw new Error("Sign in incomplete")}catch(s){throw new Error(s.message||"Sign in failed")}},signUp:async(t,a,s)=>{if(!n)throw new Error("Authentication not configured");try{const[o,...g]=(s||"").split(" "),b=g.join(" "),p=await i.client.signUp.create({emailAddress:t,password:a,firstName:o||void 0,lastName:b||void 0});return await p.prepareEmailAddressVerification({strategy:"email_code"}),{user:p,needsVerification:!0}}catch(o){throw new Error(o.message||"Sign up failed")}},signOut:async()=>{if(n)try{await i.signOut(),(window.location.pathname.startsWith("/sign-")||window.location.pathname.startsWith("/factor"))&&window.history.replaceState(null,"","/")}catch(t){throw new Error(t.message||"Sign out failed")}},resetPassword:async t=>{if(!n)throw new Error("Authentication not configured");try{await i.client.signIn.create({identifier:t,strategy:"reset_password_email_code"})}catch(a){throw new Error(a.message||"Password reset failed")}},updateProfile:async t=>{if(!n)throw new Error("Authentication not configured");if(!f)throw new Error("No user logged in");try{const a={};if(t.full_name){const[s,...o]=t.full_name.split(" ");a.firstName=s,a.lastName=o.join(" ")}return await e?.update(a),{user:e}}catch(a){throw new Error(a.message||"Profile update failed")}},updateProfileImage:async t=>{if(!n)throw new Error("Authentication not configured");if(!i.user)throw new Error("No user logged in");try{return await i.user.setProfileImage({file:t}),{user:i.user}}catch(a){throw new Error(a.message||"Profile image update failed")}},updateEmail:async(t,a)=>{if(!n)throw new Error("Authentication not configured");if(!f)throw new Error("No user logged in");try{if(a){const o=e?.emailAddresses?.[0]?.emailAddress;if(!o)throw new Error("Current email not found");const g=await i.client.signIn.create({identifier:o,password:a});if(g.status==="complete")await i.setActive({session:g.createdSessionId});else throw new Error("Re-authentication failed")}const s=await e?.createEmailAddress({email:t});if(!s)throw new Error("Failed to create new email address");return await s.prepareVerification({strategy:"email_code"}),{user:e}}catch(s){throw new Error(s.message||"Email update failed")}},verifyEmailUpdate:async(t,a)=>{if(!n)throw new Error("Authentication not configured");if(!e)throw new Error("No user logged in");try{const s=e.emailAddresses.find(o=>o.emailAddress===t);if(!s)throw new Error("New email not found on account");return await s.attemptVerification({code:a}),await e.update({primaryEmailAddressId:s.id}),{user:e}}catch(s){throw new Error(s.message||"Email verification failed")}},updatePassword:async t=>{if(!n)throw new Error("Authentication not configured");if(!f)throw new Error("No user logged in");try{return await e?.updatePassword({newPassword:t}),{user:e}}catch(a){throw new Error(a.message||"Password update failed")}}}};export{L as a,X as b,x as c,q as d,M as g,Z as s,D as u};
