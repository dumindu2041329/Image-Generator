import{j as e,u as z,a as Q,b as W}from"./index-DvgAf0yS.js";import{r as d,u as Y}from"./vendor-router-B0usbLSA.js";import{T as V,X,H as k,A as J,o as K,F as Z,p as S,D as ee,q as se,r as te,s as ae}from"./vendor-utils-DVH-fnlD.js";import"./vendor-react-CA82q7Og.js";import"./vendor-supabase-l0Uqy5La.js";import"./vendor-clerk-TSkbXxwZ.js";const re=({isOpen:o,title:w,message:f,confirmText:C="Confirm",cancelText:m="Cancel",onConfirm:y,onCancel:u,variant:g="danger"})=>{if(!o)return null;const x={danger:{icon:"text-red-400",iconBg:"bg-red-500/20",confirmBtn:"bg-red-500 hover:bg-red-600 text-white",border:"border-red-500/20"},warning:{icon:"text-yellow-400",iconBg:"bg-yellow-500/20",confirmBtn:"bg-yellow-500 hover:bg-yellow-600 text-white",border:"border-yellow-500/20"},info:{icon:"text-blue-400",iconBg:"bg-blue-500/20",confirmBtn:"bg-blue-500 hover:bg-blue-600 text-white",border:"border-blue-500/20"}}[g],b=h=>{h.target===h.currentTarget&&u()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:b,children:e.jsxs("div",{className:`glass rounded-2xl p-6 max-w-md w-full border ${x.border} transform transition-all duration-200 scale-100`,children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:`rounded-full p-2 ${x.iconBg}`,children:e.jsx(V,{className:`w-6 h-6 ${x.icon}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:w}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:f})]}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-white transition-colors p-1 rounded-lg hover:bg-white/10",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 text-gray-300 hover:text-white glass glass-hover rounded-xl transition-all duration-200",children:m}),e.jsx("button",{onClick:y,className:`px-6 py-2 rounded-xl font-medium transition-all duration-200 ${x.confirmBtn}`,children:C})]})]})})},xe=()=>{const[o,w]=d.useState("all"),[f,C]=d.useState(""),[m,y]=d.useState(new Set),[u,g]=d.useState({isOpen:!1,imageId:""}),[l,x]=d.useState(1),[b]=d.useState(12),[h,D]=d.useState({}),$=s=>s?(s.includes("supabase"),s):"",U=(s,a="1:1")=>{const t={"16:9":{width:1024,height:576},"4:3":{width:768,height:576},"1:1":{width:768,height:768}},r=t[a]||t["1:1"],n=`${s}, masterpiece, best quality, highly detailed`,i=Date.now()%1e6;return`https://image.pollinations.ai/prompt/${encodeURIComponent(n)}?width=${r.width}&height=${r.height}&seed=${i}&enhance=true&nologo=true&model=flux&steps=20`},{savedImages:p,loading:F,deleteImage:R,toggleFavorite:E}=z(),{user:T,isConfigured:O}=Q(),{showSuccess:j,showError:N}=W(),I=Y();d.useEffect(()=>{console.log("savedImages state updated:",p.length,"images"),p.length>0&&(console.log("All saved images with URLs:"),p.slice(0,5).forEach((s,a)=>{console.log(`Image ${a+1}:`,{id:s.id,url_full:s.image_url,url_preview:s.image_url?.substring(0,100)+"...",url_type:s.image_url?.includes("supabase")?"SUPABASE_STORAGE":"DIRECT_POLLINATIONS",style:s.style,aspect_ratio:s.aspect_ratio,storage_path:s.storage_file_path})}))},[p]);const v=p.filter(s=>{if(!s)return!1;const a=o==="all"||o==="favorites"&&s.is_favorite,t=s.prompt?.toLowerCase().includes(f.toLowerCase())??!1;return a&&t}),c=Math.ceil(v.length/b),L=l*b,P=L-b,A=v.slice(P,L);d.useEffect(()=>{x(1)},[o,f]);const _=s=>{x(Math.max(1,Math.min(s,c)))},B=async(s,a)=>{if(!m.has(a)){y(t=>new Set(t).add(a));try{const t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch image: ${t.status}`);const r=await t.blob(),n=window.URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=`ai-generated-${a}.jpg`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n),j("Download Started","Your image is being downloaded.")}catch(t){console.error("Download error:",t),N("Download Failed","Could not download the image. Please try again.")}finally{y(t=>{const r=new Set(t);return r.delete(a),r})}}},G=s=>{g({isOpen:!0,imageId:s})},M=async()=>{try{await R(u.imageId),g({isOpen:!1,imageId:""}),j("Image Deleted","The image has been permanently removed from your collection.")}catch(s){g({isOpen:!1,imageId:""});const a=s instanceof Error?s.message:"Unknown error occurred";a.includes("storage")||a.includes("400")?N("Delete Failed","Could not delete the image file from storage, but it has been removed from your collection. This may be due to a temporary storage issue."):N("Delete Failed",`Could not delete the image. ${a}`)}},H=async(s,a)=>{try{await E(s),a?j("Removed from Favorites","The image has been removed from your favorites."):j("Added to Favorites","The image has been added to your favorites.")}catch{N("Failed to Update Favorite","Could not update the favorite status. Please try again.")}},q=()=>{g({isOpen:!1,imageId:""})};return!O||!T?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:e.jsx("div",{className:"glass rounded-2xl p-8 max-w-md w-full border border-white/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Sign In Required"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Sign in to view your saved image history and favorites."}),e.jsx("button",{onClick:()=>I("/"),className:"glass glass-hover rounded-xl px-6 py-3 text-blue-400 font-medium transition-all duration-300",children:"Go Back to Generator"})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"glass border-b border-white/20 p-3 sm:p-4 md:p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 md:gap-4 mb-3 sm:mb-4",children:[e.jsx("button",{onClick:()=>I("/"),className:"glass glass-hover rounded-lg sm:rounded-xl p-2 sm:p-3 text-gray-400 hover:text-white transition-colors flex-shrink-0",children:e.jsx(J,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-white flex items-center gap-2 sm:gap-3",children:[e.jsx(k,{className:"w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8"}),"My Images"]}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-400 mt-0.5 sm:mt-1",children:[v.length," image",v.length!==1?"s":"",o==="favorites"?" in favorites":""]})]}),e.jsx("button",{onClick:()=>{console.log("🔍 DEBUGGING IMAGE URLS:"),p.slice(0,3).forEach((s,a)=>{if(console.log(`Image ${a+1}:`,{id:s.id,original_url:s.image_url,fresh_url:h[s.id],storage_path:s.storage_file_path,prompt:s.prompt?.substring(0,50)+"..."}),s.image_url){const t=new Image;t.onload=()=>console.log(`✅ Original URL ${a+1} loads`),t.onerror=()=>{console.log(`❌ Original URL ${a+1} fails - generating fresh URL`);const r=U(s.prompt||"",s.aspect_ratio||"1:1");console.log("Fresh URL generated:",r);const n=new Image;n.onload=()=>console.log(`✅ Fresh URL ${a+1} loads!`),n.onerror=()=>console.log(`❌ Fresh URL ${a+1} also fails`),n.src=r},t.src=s.image_url}})},className:"glass rounded-lg px-3 py-1 text-xs text-yellow-400 hover:text-yellow-300",children:"Debug URLs"})]})})}),e.jsx("div",{className:"glass border-b border-white/20 p-3 sm:p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),e.jsx("input",{type:"text",value:f,onChange:s=>C(s.target.value),placeholder:"Search your images...",className:"w-full pl-9 sm:pl-10 pr-3 sm:pr-4 py-2 sm:py-2.5 glass rounded-lg sm:rounded-xl text-sm sm:text-base text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w("all"),className:`flex-1 sm:flex-none flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 rounded-lg sm:rounded-xl text-sm sm:text-base transition-all duration-300 ${o==="all"?"bg-blue-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"All"})]}),e.jsxs("button",{onClick:()=>w("favorites"),className:`flex-1 sm:flex-none flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 rounded-lg sm:rounded-xl text-sm sm:text-base transition-all duration-300 ${o==="favorites"?"bg-pink-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Favorites"})]})]})]})}),e.jsx("div",{className:"p-3 sm:p-4 md:p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:F?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-3 sm:mb-4"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-400",children:"Loading your images..."})]}):v.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(k,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-400 mx-auto mb-3 sm:mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-white mb-2 px-4",children:o==="favorites"?"No favorite images yet":"No images saved yet"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-400 mb-4 sm:mb-6 px-4",children:o==="favorites"?"Heart some images to see them here!":"Start generating images to build your collection!"}),e.jsx("button",{onClick:()=>I("/"),className:"glass glass-hover rounded-lg sm:rounded-xl px-4 sm:px-6 py-2.5 sm:py-3 text-sm sm:text-base text-blue-400 font-medium transition-all duration-300",children:"Generate Your First Image"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-5 md:gap-6",children:A.filter(s=>s).map(s=>e.jsxs("div",{className:"glass rounded-xl sm:rounded-2xl overflow-hidden group",children:[e.jsxs("div",{className:"relative aspect-square bg-gray-800",children:[e.jsx("img",{src:h[s.id]||$(s.image_url),alt:s.prompt||"Generated image",className:"w-full h-full object-cover",loading:"lazy",onError:a=>{console.error("Image failed to load:",{url:s.image_url,imageId:s.id,usingFreshUrl:!!h[s.id],error:"Load failed"});const t=a.target;if(!h[s.id]&&s.prompt){console.log("Generating fresh URL for failed image:",s.id);const n=U(s.prompt,s.aspect_ratio);D(i=>({...i,[s.id]:n}));return}t.style.display="none";const r=t.parentElement?.querySelector(".image-placeholder");r&&r.classList.remove("hidden")},onLoad:a=>{console.log("Image loaded successfully:",{url:s.image_url?.substring(0,100)+"...",imageId:s.id,naturalWidth:a.target.naturalWidth,naturalHeight:a.target.naturalHeight});const t=a.target.parentElement?.querySelector(".image-placeholder");t&&t.classList.add("hidden")}}),e.jsx("div",{className:"image-placeholder absolute inset-0 flex items-center justify-center bg-gray-700 text-gray-400",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-2 opacity-50",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})})}),e.jsx("p",{className:"text-xs",children:"Image unavailable"})]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx("button",{onClick:()=>H(s.id,s.is_favorite||!1),className:`glass rounded-full p-2 transition-colors duration-300 ${s.is_favorite?"text-pink-400 bg-pink-500/20":"text-gray-400 hover:text-pink-400"}`,title:s.is_favorite?"Remove from favorites":"Add to favorites",children:e.jsx(S,{className:`w-4 h-4 ${s.is_favorite?"fill-current":""}`})}),e.jsx("button",{onClick:()=>B(s.image_url||"",s.id),disabled:m.has(s.id),className:`glass rounded-full p-2 transition-colors duration-300 ${m.has(s.id)?"opacity-50 cursor-not-allowed text-gray-500":"text-gray-400 hover:text-blue-400"}`,title:m.has(s.id)?"Downloading...":"Download image",children:m.has(s.id)?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(s.id),className:"glass rounded-full p-2 text-gray-400 hover:text-red-400 transition-colors duration-300",title:"Delete image",children:e.jsx(se,{className:"w-4 h-4"})})]}),s.is_favorite&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(S,{className:"w-5 h-5 text-pink-400 fill-current"})})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsx("p",{className:"text-gray-300 text-xs sm:text-sm line-clamp-2 mb-2",children:s.prompt||"No prompt available"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1 text-xs text-gray-500",children:[e.jsx("span",{children:s.aspect_ratio||"Unknown"}),e.jsx("span",{children:s.style||"Unknown"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown date"})]})]})]},s.id))}),c>1&&e.jsxs("div",{className:"flex justify-center items-center mt-8 gap-2",children:[e.jsx("button",{onClick:()=>_(l-1),disabled:l===1,className:`glass rounded-xl p-2 ${l===1?"opacity-50 cursor-not-allowed text-gray-500":"glass-hover text-gray-300 hover:text-white"}`,"aria-label":"Previous page",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,c)},(s,a)=>{let t;return c<=5||l<=3?t=a+1:l>=c-2?t=c-4+a:t=l-2+a,e.jsx("button",{onClick:()=>_(t),className:`w-8 h-8 flex items-center justify-center rounded-lg transition-colors ${l===t?"bg-blue-500 text-white":"glass glass-hover text-gray-300"}`,children:t},t)})}),e.jsx("button",{onClick:()=>_(l+1),disabled:l===c,className:`glass rounded-xl p-2 ${l===c?"opacity-50 cursor-not-allowed text-gray-500":"glass-hover text-gray-300 hover:text-white"}`,"aria-label":"Next page",children:e.jsx(ae,{className:"w-5 h-5"})})]})]})})})]}),e.jsx(re,{isOpen:u.isOpen,title:"Delete Image",message:"Are you sure you want to delete this image? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",onConfirm:M,onCancel:q,variant:"danger"})]})};export{xe as default};
