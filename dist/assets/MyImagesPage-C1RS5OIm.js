import{j as e,u as B,a as E,b as L}from"./index-DY8NZbS7.js";import{r as m,u as O}from"./vendor-router-B0usbLSA.js";import{T as U,X as A,H as N,A as R,p as H,F as G,n as k,D as q,q as z}from"./vendor-utils-BqSSzSi_.js";import"./vendor-react-CA82q7Og.js";import"./vendor-supabase-l0Uqy5La.js";import"./vendor-clerk-TSkbXxwZ.js";const M=({isOpen:r,title:x,message:u,confirmText:w="Confirm",cancelText:l="Cancel",onConfirm:h,onCancel:o,variant:n="danger"})=>{if(!r)return null;const i={danger:{icon:"text-red-400",iconBg:"bg-red-500/20",confirmBtn:"bg-red-500 hover:bg-red-600 text-white",border:"border-red-500/20"},warning:{icon:"text-yellow-400",iconBg:"bg-yellow-500/20",confirmBtn:"bg-yellow-500 hover:bg-yellow-600 text-white",border:"border-yellow-500/20"},info:{icon:"text-blue-400",iconBg:"bg-blue-500/20",confirmBtn:"bg-blue-500 hover:bg-blue-600 text-white",border:"border-blue-500/20"}}[n],j=g=>{g.target===g.currentTarget&&o()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:j,children:e.jsxs("div",{className:`glass rounded-2xl p-6 max-w-md w-full border ${i.border} transform transition-all duration-200 scale-100`,children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:`rounded-full p-2 ${i.iconBg}`,children:e.jsx(U,{className:`w-6 h-6 ${i.icon}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:x}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:u})]}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-white transition-colors p-1 rounded-lg hover:bg-white/10",children:e.jsx(A,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-gray-300 hover:text-white glass glass-hover rounded-xl transition-all duration-200",children:l}),e.jsx("button",{onClick:h,className:`px-6 py-2 rounded-xl font-medium transition-all duration-200 ${i.confirmBtn}`,children:w})]})]})})},V=()=>{const[r,x]=m.useState("all"),[u,w]=m.useState(""),[l,h]=m.useState(new Set),[o,n]=m.useState({isOpen:!1,imageId:""}),{savedImages:d,loading:i,deleteImage:j,toggleFavorite:g}=B(),{user:D,isConfigured:S}=E(),{showSuccess:f,showError:p}=L(),y=O();m.useEffect(()=>{console.log("savedImages state updated:",d.length,"images"),d.forEach((s,t)=>{console.log(`Image ${t}:`,{id:s.id,is_favorite:s.is_favorite,prompt:s.prompt?.substring(0,50)})})},[d]);const b=d.filter(s=>{if(!s)return!1;const t=r==="all"||r==="favorites"&&s.is_favorite,a=s.prompt?.toLowerCase().includes(u.toLowerCase())??!1;return t&&a}),F=async(s,t)=>{if(!l.has(t)){h(a=>new Set(a).add(t));try{const a=await fetch(s);if(!a.ok)throw new Error(`Failed to fetch image: ${a.status}`);const v=await a.blob(),C=window.URL.createObjectURL(v),c=document.createElement("a");c.href=C,c.download=`ai-generated-${t}.jpg`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(C),f("Download Started","Your image is being downloaded.")}catch(a){console.error("Download error:",a),p("Download Failed","Could not download the image. Please try again.")}finally{h(a=>{const v=new Set(a);return v.delete(t),v})}}},I=s=>{n({isOpen:!0,imageId:s})},T=async()=>{try{await j(o.imageId),n({isOpen:!1,imageId:""}),f("Image Deleted","The image has been permanently removed from your collection.")}catch(s){n({isOpen:!1,imageId:""});const t=s instanceof Error?s.message:"Unknown error occurred";t.includes("storage")||t.includes("400")?p("Delete Failed","Could not delete the image file from storage, but it has been removed from your collection. This may be due to a temporary storage issue."):p("Delete Failed",`Could not delete the image. ${t}`)}},_=async(s,t)=>{try{console.log("Starting favorite toggle for image:",s,"current status:",t),await g(s),console.log("Favorite toggle completed for image:",s),t?f("Removed from Favorites","The image has been removed from your favorites."):f("Added to Favorites","The image has been added to your favorites.")}catch(a){console.error("Error in handleToggleFavorite:",a),p("Failed to Update Favorite","Could not update the favorite status. Please try again.")}},$=()=>{n({isOpen:!1,imageId:""})};return!S||!D?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:e.jsx("div",{className:"glass rounded-2xl p-8 max-w-md w-full border border-white/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Sign In Required"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Sign in to view your saved image history and favorites."}),e.jsx("button",{onClick:()=>y("/"),className:"glass glass-hover rounded-xl px-6 py-3 text-blue-400 font-medium transition-all duration-300",children:"Go Back to Generator"})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"glass border-b border-white/20 p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>y("/"),className:"glass glass-hover rounded-xl p-3 text-gray-400 hover:text-white transition-colors",children:e.jsx(R,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8"}),"My Images"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[b.length," image",b.length!==1?"s":"",r==="favorites"?" in favorites":""]})]})]})})}),e.jsx("div",{className:"glass border-b border-white/20 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:u,onChange:s=>w(s.target.value),placeholder:"Search your images...",className:"w-full pl-10 pr-4 py-2 glass rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x("all"),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${r==="all"?"bg-blue-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"All"})]}),e.jsxs("button",{onClick:()=>x("favorites"),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${r==="favorites"?"bg-pink-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"Favorites"})]})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading your images..."})]}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:r==="favorites"?"No favorite images yet":"No images saved yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:r==="favorites"?"Heart some images to see them here!":"Start generating images to build your collection!"}),e.jsx("button",{onClick:()=>y("/"),className:"glass glass-hover rounded-xl px-6 py-3 text-blue-400 font-medium transition-all duration-300",children:"Generate Your First Image"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:b.filter(s=>s).map(s=>e.jsxs("div",{className:"glass rounded-2xl overflow-hidden group",children:[e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:s.image_url||"",alt:s.prompt||"Generated image",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx("button",{onClick:()=>_(s.id,s.is_favorite||!1),className:`glass rounded-full p-2 transition-colors duration-300 ${s.is_favorite?"text-pink-400 bg-pink-500/20":"text-gray-400 hover:text-pink-400"}`,title:s.is_favorite?"Remove from favorites":"Add to favorites",children:e.jsx(k,{className:`w-4 h-4 ${s.is_favorite?"fill-current":""}`})}),e.jsx("button",{onClick:()=>F(s.image_url||"",s.id),disabled:l.has(s.id),className:`glass rounded-full p-2 transition-colors duration-300 ${l.has(s.id)?"opacity-50 cursor-not-allowed text-gray-500":"text-gray-400 hover:text-blue-400"}`,title:l.has(s.id)?"Downloading...":"Download image",children:l.has(s.id)?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(s.id),className:"glass rounded-full p-2 text-gray-400 hover:text-red-400 transition-colors duration-300",title:"Delete image",children:e.jsx(z,{className:"w-4 h-4"})})]}),s.is_favorite&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(k,{className:"w-5 h-5 text-pink-400 fill-current"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-300 text-sm line-clamp-2 mb-2",children:s.prompt||"No prompt available"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:s.aspect_ratio||"Unknown"}),e.jsx("span",{children:s.style||"Unknown"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown date"})]})]})]},s.id))})})})]}),e.jsx(M,{isOpen:o.isOpen,title:"Delete Image",message:"Are you sure you want to delete this image? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",onConfirm:T,onCancel:$,variant:"danger"})]})};export{V as default};
