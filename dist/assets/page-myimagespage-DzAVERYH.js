import{r as i,f as L,j as e,H as g,B as O,E as U,F as $,x as p,D as R,J as A}from"./vendor-react-qTQEQa1M.js";import{u as H}from"./page-homepage-p6IQbOpW.js";import{u as G,a as M,C as P}from"./components-SDB2xlms.js";import"./vendor-misc-Bdr6O-sw.js";import"./vendor-clerk-714666yM.js";import"./services-CtNDYofV.js";import"./vendor-supabase-2p6XB-mb.js";const V=()=>{const[r,f]=i.useState("all"),[v,y]=i.useState(""),[o,b]=i.useState(new Set),[w,n]=i.useState({isOpen:!1,imageId:""}),{savedImages:d,loading:N,deleteImage:C,toggleFavorite:k}=H(),{user:D,isConfigured:S}=G(),{showSuccess:c,showError:m}=M(),h=L();i.useEffect(()=>{console.log("savedImages state updated:",d.length,"images"),d.forEach((s,t)=>{console.log(`Image ${t}:`,{id:s.id,is_favorite:s.is_favorite,prompt:s.prompt?.substring(0,50)})})},[d]);const u=d.filter(s=>{if(!s)return!1;const t=r==="all"||r==="favorites"&&s.is_favorite,a=s.prompt?.toLowerCase().includes(v.toLowerCase())??!1;return t&&a}),F=async(s,t)=>{if(!o.has(t)){b(a=>new Set(a).add(t));try{const a=await fetch(s);if(!a.ok)throw new Error(`Failed to fetch image: ${a.status}`);const x=await a.blob(),j=window.URL.createObjectURL(x),l=document.createElement("a");l.href=j,l.download=`ai-generated-${t}.jpg`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(j),c("Download Started","Your image is being downloaded.")}catch(a){console.error("Download error:",a),m("Download Failed","Could not download the image. Please try again.")}finally{b(a=>{const x=new Set(a);return x.delete(t),x})}}},I=s=>{n({isOpen:!0,imageId:s})},_=async()=>{try{await C(w.imageId),n({isOpen:!1,imageId:""}),c("Image Deleted","The image has been permanently removed from your collection.")}catch(s){n({isOpen:!1,imageId:""});const t=s instanceof Error?s.message:"Unknown error occurred";t.includes("storage")||t.includes("400")?m("Delete Failed","Could not delete the image file from storage, but it has been removed from your collection. This may be due to a temporary storage issue."):m("Delete Failed",`Could not delete the image. ${t}`)}},T=async(s,t)=>{try{console.log("Starting favorite toggle for image:",s,"current status:",t),await k(s),console.log("Favorite toggle completed for image:",s),t?c("Removed from Favorites","The image has been removed from your favorites."):c("Added to Favorites","The image has been added to your favorites.")}catch(a){console.error("Error in handleToggleFavorite:",a),m("Failed to Update Favorite","Could not update the favorite status. Please try again.")}},E=()=>{n({isOpen:!1,imageId:""})};return!S||!D?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:e.jsx("div",{className:"glass rounded-2xl p-8 max-w-md w-full border border-white/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Sign In Required"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Sign in to view your saved image history and favorites."}),e.jsx("button",{onClick:()=>h("/"),className:"glass glass-hover rounded-xl px-6 py-3 text-blue-400 font-medium transition-all duration-300",children:"Go Back to Generator"})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"glass border-b border-white/20 p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>h("/"),className:"glass glass-hover rounded-xl p-3 text-gray-400 hover:text-white transition-colors",children:e.jsx(O,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(g,{className:"w-8 h-8"}),"My Images"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[u.length," image",u.length!==1?"s":"",r==="favorites"?" in favorites":""]})]})]})})}),e.jsx("div",{className:"glass border-b border-white/20 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:v,onChange:s=>y(s.target.value),placeholder:"Search your images...",className:"w-full pl-10 pr-4 py-2 glass rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f("all"),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${r==="all"?"bg-blue-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"All"})]}),e.jsxs("button",{onClick:()=>f("favorites"),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${r==="favorites"?"bg-pink-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:"Favorites"})]})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:N?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading your images..."})]}):u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:r==="favorites"?"No favorite images yet":"No images saved yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:r==="favorites"?"Heart some images to see them here!":"Start generating images to build your collection!"}),e.jsx("button",{onClick:()=>h("/"),className:"glass glass-hover rounded-xl px-6 py-3 text-blue-400 font-medium transition-all duration-300",children:"Generate Your First Image"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:u.filter(s=>s).map(s=>e.jsxs("div",{className:"glass rounded-2xl overflow-hidden group",children:[e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:s.image_url||"",alt:s.prompt||"Generated image",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx("button",{onClick:()=>T(s.id,s.is_favorite||!1),className:`glass rounded-full p-2 transition-colors duration-300 ${s.is_favorite?"text-pink-400 bg-pink-500/20":"text-gray-400 hover:text-pink-400"}`,title:s.is_favorite?"Remove from favorites":"Add to favorites",children:e.jsx(p,{className:`w-4 h-4 ${s.is_favorite?"fill-current":""}`})}),e.jsx("button",{onClick:()=>F(s.image_url||"",s.id),disabled:o.has(s.id),className:`glass rounded-full p-2 transition-colors duration-300 ${o.has(s.id)?"opacity-50 cursor-not-allowed text-gray-500":"text-gray-400 hover:text-blue-400"}`,title:o.has(s.id)?"Downloading...":"Download image",children:o.has(s.id)?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(s.id),className:"glass rounded-full p-2 text-gray-400 hover:text-red-400 transition-colors duration-300",title:"Delete image",children:e.jsx(A,{className:"w-4 h-4"})})]}),s.is_favorite&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(p,{className:"w-5 h-5 text-pink-400 fill-current"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-300 text-sm line-clamp-2 mb-2",children:s.prompt||"No prompt available"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:s.aspect_ratio||"Unknown"}),e.jsx("span",{children:s.style||"Unknown"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown date"})]})]})]},s.id))})})})]}),e.jsx(P,{isOpen:w.isOpen,title:"Delete Image",message:"Are you sure you want to delete this image? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",onConfirm:_,onCancel:E,variant:"danger"})]})};export{V as default};
