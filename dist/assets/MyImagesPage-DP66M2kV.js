import{j as e,u as M,a as H,b as G}from"./index-BcwWYJOa.js";import{r as n,u as q}from"./vendor-router-B0usbLSA.js";import{T as z,X as Q,H as k,A as Y,q as X,F as J,r as D,D as K,s as V,t as W,u as Z}from"./vendor-utils-CjA-DQXP.js";import"./vendor-react-CA82q7Og.js";import"./vendor-supabase-l0Uqy5La.js";import"./vendor-clerk-TSkbXxwZ.js";const ee=({isOpen:l,title:p,message:u,confirmText:y="Confirm",cancelText:i="Cancel",onConfirm:b,onCancel:m,variant:x="danger"})=>{if(!l)return null;const d={danger:{icon:"text-red-400",iconBg:"bg-red-500/20",confirmBtn:"bg-red-500 hover:bg-red-600 text-white",border:"border-red-500/20"},warning:{icon:"text-yellow-400",iconBg:"bg-yellow-500/20",confirmBtn:"bg-yellow-500 hover:bg-yellow-600 text-white",border:"border-yellow-500/20"},info:{icon:"text-blue-400",iconBg:"bg-blue-500/20",confirmBtn:"bg-blue-500 hover:bg-blue-600 text-white",border:"border-blue-500/20"}}[x],h=c=>{c.target===c.currentTarget&&m()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:h,children:e.jsxs("div",{className:`glass rounded-2xl p-6 max-w-md w-full border ${d.border} transform transition-all duration-200 scale-100`,children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:`rounded-full p-2 ${d.iconBg}`,children:e.jsx(z,{className:`w-6 h-6 ${d.icon}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:p}),e.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:u})]}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-white transition-colors p-1 rounded-lg hover:bg-white/10",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 text-gray-300 hover:text-white glass glass-hover rounded-xl transition-all duration-200",children:i}),e.jsx("button",{onClick:b,className:`px-6 py-2 rounded-xl font-medium transition-all duration-200 ${d.confirmBtn}`,children:y})]})]})})},ne=()=>{const[l,p]=n.useState("all"),[u,y]=n.useState(""),[i,b]=n.useState(new Set),[m,x]=n.useState({isOpen:!1,imageId:""}),[r,d]=n.useState(1),[h]=n.useState(12),{savedImages:c,loading:F,deleteImage:$,toggleFavorite:T}=M(),{user:_,isConfigured:L}=H(),{showSuccess:v,showError:w}=G(),N=q();n.useEffect(()=>{console.log("savedImages state updated:",c.length,"images"),c.forEach((s,a)=>{console.log(`Image ${a}:`,{id:s.id,is_favorite:s.is_favorite,prompt:s.prompt?.substring(0,50)})})},[c]);const g=c.filter(s=>{if(!s)return!1;const a=l==="all"||l==="favorites"&&s.is_favorite,t=s.prompt?.toLowerCase().includes(u.toLowerCase())??!1;return a&&t}),o=Math.ceil(g.length/h),S=r*h,O=S-h,B=g.slice(O,S);n.useEffect(()=>{d(1)},[l,u]);const C=s=>{d(Math.max(1,Math.min(s,o)))},E=async(s,a)=>{if(!i.has(a)){b(t=>new Set(t).add(a));try{const t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch image: ${t.status}`);const j=await t.blob(),I=window.URL.createObjectURL(j),f=document.createElement("a");f.href=I,f.download=`ai-generated-${a}.jpg`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(I),v("Download Started","Your image is being downloaded.")}catch(t){console.error("Download error:",t),w("Download Failed","Could not download the image. Please try again.")}finally{b(t=>{const j=new Set(t);return j.delete(a),j})}}},P=s=>{x({isOpen:!0,imageId:s})},A=async()=>{try{await $(m.imageId),x({isOpen:!1,imageId:""}),v("Image Deleted","The image has been permanently removed from your collection.")}catch(s){x({isOpen:!1,imageId:""});const a=s instanceof Error?s.message:"Unknown error occurred";a.includes("storage")||a.includes("400")?w("Delete Failed","Could not delete the image file from storage, but it has been removed from your collection. This may be due to a temporary storage issue."):w("Delete Failed",`Could not delete the image. ${a}`)}},R=async(s,a)=>{try{console.log("Starting favorite toggle for image:",s,"current status:",a),await T(s),console.log("Favorite toggle completed for image:",s),a?v("Removed from Favorites","The image has been removed from your favorites."):v("Added to Favorites","The image has been added to your favorites.")}catch(t){console.error("Error in handleToggleFavorite:",t),w("Failed to Update Favorite","Could not update the favorite status. Please try again.")}},U=()=>{x({isOpen:!1,imageId:""})};return!L||!_?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:e.jsx("div",{className:"glass rounded-2xl p-8 max-w-md w-full border border-white/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Sign In Required"}),e.jsx("p",{className:"text-gray-300 mb-6",children:"Sign in to view your saved image history and favorites."}),e.jsx("button",{onClick:()=>N("/"),className:"glass glass-hover rounded-xl px-6 py-3 text-blue-400 font-medium transition-all duration-300",children:"Go Back to Generator"})]})})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500/20 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"glass border-b border-white/20 p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>N("/"),className:"glass glass-hover rounded-xl p-3 text-gray-400 hover:text-white transition-colors",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8"}),"My Images"]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[g.length," image",g.length!==1?"s":"",l==="favorites"?" in favorites":""]})]})]})})}),e.jsx("div",{className:"glass border-b border-white/20 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:u,onChange:s=>y(s.target.value),placeholder:"Search your images...",className:"w-full pl-10 pr-4 py-2 glass rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>p("all"),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${l==="all"?"bg-blue-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"All"})]}),e.jsxs("button",{onClick:()=>p("favorites"),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${l==="favorites"?"bg-pink-500 text-white":"glass glass-hover text-gray-300"}`,children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"Favorites"})]})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:F?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading your images..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:l==="favorites"?"No favorite images yet":"No images saved yet"}),e.jsx("p",{className:"text-gray-400 mb-6",children:l==="favorites"?"Heart some images to see them here!":"Start generating images to build your collection!"}),e.jsx("button",{onClick:()=>N("/"),className:"glass glass-hover rounded-xl px-6 py-3 text-blue-400 font-medium transition-all duration-300",children:"Generate Your First Image"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:B.filter(s=>s).map(s=>e.jsxs("div",{className:"glass rounded-2xl overflow-hidden group",children:[e.jsxs("div",{className:"relative aspect-square",children:[e.jsx("img",{src:s.image_url||"",alt:s.prompt||"Generated image",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx("button",{onClick:()=>R(s.id,s.is_favorite||!1),className:`glass rounded-full p-2 transition-colors duration-300 ${s.is_favorite?"text-pink-400 bg-pink-500/20":"text-gray-400 hover:text-pink-400"}`,title:s.is_favorite?"Remove from favorites":"Add to favorites",children:e.jsx(D,{className:`w-4 h-4 ${s.is_favorite?"fill-current":""}`})}),e.jsx("button",{onClick:()=>E(s.image_url||"",s.id),disabled:i.has(s.id),className:`glass rounded-full p-2 transition-colors duration-300 ${i.has(s.id)?"opacity-50 cursor-not-allowed text-gray-500":"text-gray-400 hover:text-blue-400"}`,title:i.has(s.id)?"Downloading...":"Download image",children:i.has(s.id)?e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P(s.id),className:"glass rounded-full p-2 text-gray-400 hover:text-red-400 transition-colors duration-300",title:"Delete image",children:e.jsx(V,{className:"w-4 h-4"})})]}),s.is_favorite&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx(D,{className:"w-5 h-5 text-pink-400 fill-current"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-300 text-sm line-clamp-2 mb-2",children:s.prompt||"No prompt available"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:s.aspect_ratio||"Unknown"}),e.jsx("span",{children:s.style||"Unknown"}),e.jsx("span",{children:s.created_at?new Date(s.created_at).toLocaleDateString():"Unknown date"})]})]})]},s.id))}),o>1&&e.jsxs("div",{className:"flex justify-center items-center mt-8 gap-2",children:[e.jsx("button",{onClick:()=>C(r-1),disabled:r===1,className:`glass rounded-xl p-2 ${r===1?"opacity-50 cursor-not-allowed text-gray-500":"glass-hover text-gray-300 hover:text-white"}`,"aria-label":"Previous page",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,o)},(s,a)=>{let t;return o<=5||r<=3?t=a+1:r>=o-2?t=o-4+a:t=r-2+a,e.jsx("button",{onClick:()=>C(t),className:`w-8 h-8 flex items-center justify-center rounded-lg transition-colors ${r===t?"bg-blue-500 text-white":"glass glass-hover text-gray-300"}`,children:t},t)})}),e.jsx("button",{onClick:()=>C(r+1),disabled:r===o,className:`glass rounded-xl p-2 ${r===o?"opacity-50 cursor-not-allowed text-gray-500":"glass-hover text-gray-300 hover:text-white"}`,"aria-label":"Next page",children:e.jsx(Z,{className:"w-5 h-5"})})]})]})})})]}),e.jsx(ee,{isOpen:m.isOpen,title:"Delete Image",message:"Are you sure you want to delete this image? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",onConfirm:A,onCancel:U,variant:"danger"})]})};export{ne as default};
